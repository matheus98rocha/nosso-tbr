import type { Metadata } from "next";
import Header from "@/components/header/header";
import { cache, Suspense } from "react";
import { UserProvider } from "@/providers/UserProvider";
import { getCurrentUser } from "@/services/users/service/getCurrentUser.service";

export const metadata: Metadata = {
  title: "Nosso TBR",
  description: "Generated by create next app",
};

const getCachedUser = cache(async () => {
  return await getCurrentUser();
});

export default async function MainLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const user = await getCachedUser();

  return (
    <UserProvider initialUser={user}>
      <Suspense
        fallback={
          <svg
            className="mr-3 size-5 animate-spin ..."
            viewBox="0 0 24 24"
          ></svg>
        }
      >
        <Header />
      </Suspense>
      <div className="pt-40 p-6 flex flex-col items-center gap-6">
        {children}
      </div>
    </UserProvider>
  );
}
